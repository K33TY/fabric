#!/bin/bash

# Wrapper script for fabric.store.Main, the Fabric store.

source "$(dirname $0)/defs"

while true; do
  case "$1" in
    "") break;;
    -v) verbose="1"; shift;;
    -classpath) EXTRACP=$2; shift; shift;;    
    -j)
            shift
            vmargs="${vmargs} '$1'"
            shift
            ;;
    --debug)
            shift
            vmargs="${vmargs} -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=3370"
            ;;
    *) args="${args} '$1'"; shift;;
  esac
done

classpath="${FABRIC_STORE_CP}:${EXTRACP}:${classpath}"

#command="\"${JAVA}\" $vmargs -classpath \"$(fixpath $classpath)\" fabric.store.Node $args"
sigcp="${TOP}/sig-classes/fabric:${TOP}/lib/fabric-sig.jar:${sigcp}"
filsigcp="${TOP}/sig-classes/fabil:${TOP}/lib/fabric-il-sig.jar:${filsigcp}"
command="\"${JAVA}\" $vmargs -classpath \"$(fixpath $classpath)\" \
					fabric.store.Node --sigcp \"$(fixpath ${sigcp})\" \
                               --filsigcp \"$(fixpath ${filsigcp})\" ${args}"

if [ -n "${verbose}" ]
then
  echo "${command}"
fi

eval "${command}"
