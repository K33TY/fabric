#!/bin/bash

# Wrapper script for bolt.Main, the Bolt compiler.

source "$(dirname $0)/defs"

while true; do
  case "$1" in
    "") break;;
    -v) verbose="1"; shift;;
    -j)
      shift
      vmargs="${vmargs} '$1'"
      shift
      ;;
    --jvm-cp)
      shift
      cp="${cp}:$1"
      shift
      ;;
    -rdebug)
      shift
      vmargs="${vmargs} -Xdebug -Xrunjdwp:transport=dt_socket,address=6666,server=y,suspend=y"
      ;;

    *) args="${args} '$1'"; shift;;
  esac
done

# XXX This should be obtained from defs, but defs should probably be reworked,
# XXX so this is here in the meantime.
classpath="${TOP}/classes"
classpath="${classpath}:${POLYGLOT}/classes"
classpath="${classpath}:${POLYGLOT}/lib/polyglot.jar"
classpath="${classpath}:${POLYGLOT}/lib/java_cup.jar"
classpath="${classpath}:${POLYGLOT}/lib/jflex.jar"
classpath="${classpath}:${cp}"

command="\"${JAVA}\" ${vmargs} -classpath \"$(fixpath ${classpath})\" \
                     bolt.Main ${args}"

if [ -n "${verbose}" ]
then
  echo "${command}"
fi

eval "${command}"
