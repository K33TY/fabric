#!/bin/bash

BINDIR="$(dirname `pwd`)/bin"
MYNAME="$(basename "$0")"

openwin() {
osascript << XXX
    tell application "System Events"
            tell process "Terminal"
                    click menu item "New Window" of menu "Shell" of menu bar 1
            end tell
    end tell
XXX
}

spawn() {
osascript << XXX
tell application "Terminal"
    activate
    tell application "System Events" to tell process "Terminal" to keystroke "t" using {command down}
    delay 1
    set t to selected tab of front window
    do script  "cd ${BINDIR}; ./${MYNAME} $1 $2 $3" in selected tab of front window
end tell
XXX
}

if [ $# -lt 3 ] ; then

  openwin
  spawn 0s store brokerStore
  spawn 1s store airlineAStore
  spawn 2s store airlineBStore
  spawn 3s store userStore

  sleep 10s

  openwin
  spawn 0s worker brokerWorker
  spawn 1s worker airlineAWorker
  spawn 2s worker airlineBWorker
  spawn 3s worker userWorker

else
  sleep $1
  shift
  CMD="./start-$1"
  shift
  "${CMD}" --name $@
fi
