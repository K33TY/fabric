<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_25) on Sat Jun 22 02:27:50 EDT 2013 -->
<title>ObjectDB</title>
<meta name="date" content="2013-06-22">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ObjectDB";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../fabric/store/db/MemoryDB.html" title="class in fabric.store.db"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?fabric/store/db/ObjectDB.html" target="_top">Frames</a></li>
<li><a href="ObjectDB.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">fabric.store.db</div>
<h2 title="Class ObjectDB" class="title">Class ObjectDB</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>fabric.store.db.ObjectDB</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><a href="../../../fabric/store/db/BdbDB.html" title="class in fabric.store.db">BdbDB</a>, <a href="../../../fabric/store/db/MemoryDB.html" title="class in fabric.store.db">MemoryDB</a></dd>
</dl>
<hr>
<br>
<pre>public abstract class <span class="strong">ObjectDB</span>
extends java.lang.Object</pre>
<div class="block"><p>
 An ObjectDB encapsulates the persistent state of the Store. It is responsible
 for storing and retrieving objects, and also for checking permissions.
 </p>
 <p>
 The ObjectDB interface is designed to support a two-phase commit protocol.
 Consequently to insert or modify an object, users must first call the
 prepare() method, passing in the set of objects to update. These objects will
 be stored, but will remain unavailable until the commit() method is called
 with the returned transaction identifier.
 </p>
 <p>
 In general, implementations of ObjectDB are not thread-safe. Only
 TransactionManager should be interacting directly with ObjectDB
 implementations; it is responsible for ensuring safe use of ObjectDB.
 </p>
 <p>
 All ObjectDB implementations should provide a constructor which takes the
 name of the store and opens the appropriate back-end database if it exists,
 or creates it if it doesn't exist.
 </p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db">ObjectDB.PendingTransaction</a></strong></code>
<div class="block">The data stored for a partially prepared transaction.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#name">name</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/OidKeyHashMap.html" title="class in fabric.common.util">OidKeyHashMap</a>&lt;<a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db">ObjectDB.PendingTransaction</a>&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#pendingByTid">pendingByTid</a></strong></code>
<div class="block">
 The table of partially prepared transactions.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/Pair.html" title="class in fabric.common.util">Pair</a>&lt;java.lang.Long,<a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/MutableInteger.html" title="class in fabric.common.util">MutableInteger</a>&gt;&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#rwLocks">rwLocks</a></strong></code>
<div class="block">
 Tracks the read/write locks for each onum.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier</th>
<th class="colLast" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected </code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#ObjectDB(java.lang.String)">ObjectDB</a></strong>(java.lang.String&nbsp;name)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#abortPrepare(long, fabric.lang.security.Principal)">abortPrepare</a></strong>(long&nbsp;tid,
            <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</code>
<div class="block">Rolls back a partially prepared transaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#beginTransaction(long, fabric.lang.security.Principal)">beginTransaction</a></strong>(long&nbsp;tid,
                <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</code>
<div class="block">Opens a new transaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#cachePartialGroup(fabric.store.PartialObjectGroup)">cachePartialGroup</a></strong>(<a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;partialGroup)</code>
<div class="block">Inserts the given partial group into the cache.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#close()">close</a></strong>()</code>
<div class="block">Gracefully shutdown the object database.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#coalescePartialGroups(fabric.store.PartialObjectGroup, fabric.store.PartialObjectGroup)">coalescePartialGroups</a></strong>(<a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;from,
                     <a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;to)</code>
<div class="block">Coalesces one partial group into another.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#commit(long, fabric.lang.security.Principal, fabric.store.SubscriptionManager)">commit</a></strong>(long&nbsp;tid,
      <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;workerPrincipal,
      <a href="../../../fabric/store/SubscriptionManager.html" title="class in fabric.store">SubscriptionManager</a>&nbsp;sm)</code>
<div class="block">Cause the objects prepared in transaction [tid] to be committed.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#ensureInit()">ensureInit</a></strong>()</code>
<div class="block">Ensures that the object database has been properly initialized.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>abstract boolean</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#exists(long)">exists</a></strong>(long&nbsp;onum)</code>
<div class="block">Checks whether an object with the corresponding onum exists, in either
 prepared or committed form.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#finishPrepare(long, fabric.lang.security.Principal)">finishPrepare</a></strong>(long&nbsp;tid,
             <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</code>
<div class="block">
 Notifies the database that the given transaction is finished preparing.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../fabric/store/db/GroupContainer.html" title="class in fabric.store.db">GroupContainer</a></code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#getCachedGroupContainer(long)">getCachedGroupContainer</a></strong>(long&nbsp;onum)</code>
<div class="block">Returns the cached GroupContainer containing the given onum.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.lang.Long</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#getCachedGroupID(long)">getCachedGroupID</a></strong>(long&nbsp;onum)</code>
<div class="block">Given the ID of the group to which the given onum belongs.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a></code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#getCachedPartialGroup(long)">getCachedPartialGroup</a></strong>(long&nbsp;onum)</code>
<div class="block">Gives the cached partial group for the given onum.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#getName()">getName</a></strong>()</code>
<div class="block">Returns the name of this store.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#getVersion(long)">getVersion</a></strong>(long&nbsp;onum)</code>
<div class="block">Returns the version number on the object stored at a particular onum.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected abstract boolean</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#isInitialized()">isInitialized</a></strong>()</code>
<div class="block">Determines whether the object database has been initialized.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#isPrepared(long, long)">isPrepared</a></strong>(long&nbsp;onum,
          long&nbsp;tid)</code>
<div class="block">Determines whether an onum has an outstanding uncommitted conflicting
 change or read.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#isWritten(long)">isWritten</a></strong>(long&nbsp;onum)</code>
<div class="block">Determine whether an onum has outstanding uncommitted changes.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>abstract long[]</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#newOnums(int)">newOnums</a></strong>(int&nbsp;num)</code>
<div class="block">
 Return a set of onums that aren't currently occupied.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#notifyCommittedUpdate(fabric.store.SubscriptionManager, long)">notifyCommittedUpdate</a></strong>(<a href="../../../fabric/store/SubscriptionManager.html" title="class in fabric.store">SubscriptionManager</a>&nbsp;sm,
                     long&nbsp;onum)</code>
<div class="block">Performs operations in response to a committed object update.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../fabric/store/db/GroupContainer.html" title="class in fabric.store.db">GroupContainer</a></code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#promotePartialGroup(java.security.PrivateKey, fabric.store.PartialObjectGroup)">promotePartialGroup</a></strong>(java.security.PrivateKey&nbsp;signingKey,
                   <a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;partialGroup)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>abstract <a href="../../../fabric/common/SerializedObject.html" title="class in fabric.common">SerializedObject</a></code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#read(long)">read</a></strong>(long&nbsp;onum)</code>
<div class="block">Return the object stored at a particular onum.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#registerRead(long, fabric.lang.security.Principal, long)">registerRead</a></strong>(long&nbsp;tid,
            <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker,
            long&nbsp;onum)</code>
<div class="block">Registers that a transaction has read an object.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#registerUpdate(long, fabric.lang.security.Principal, fabric.common.SerializedObject)">registerUpdate</a></strong>(long&nbsp;tid,
              <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker,
              <a href="../../../fabric/common/SerializedObject.html" title="class in fabric.common">SerializedObject</a>&nbsp;obj)</code>
<div class="block">Registers that a transaction has created or written to an object.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#rollback(long, fabric.lang.security.Principal)">rollback</a></strong>(long&nbsp;tid,
        <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</code>
<div class="block">Cause the objects prepared in transaction [tid] to be discarded.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected abstract void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#setInitialized()">setInitialized</a></strong>()</code>
<div class="block">Sets a flag to indicate that the object database has been initialized.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../fabric/store/db/ObjectDB.html#unpin(fabric.store.db.ObjectDB.PendingTransaction)">unpin</a></strong>(<a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db">ObjectDB.PendingTransaction</a>&nbsp;tx)</code>
<div class="block">Adjusts rwLocks to account for the fact that the given transaction is about
 to be committed or aborted.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="name">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>name</h4>
<pre>protected final&nbsp;java.lang.String name</pre>
</li>
</ul>
<a name="pendingByTid">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pendingByTid</h4>
<pre>protected final&nbsp;<a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/OidKeyHashMap.html" title="class in fabric.common.util">OidKeyHashMap</a>&lt;<a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db">ObjectDB.PendingTransaction</a>&gt;&gt; pendingByTid</pre>
<div class="block"><p>
 The table of partially prepared transactions. Note that this does not need
 to be saved to stable storage, since we only need to persist transactions
 that are fully prepared.
 </p>
 <p>
 Maps tids to principal oids to PendingTransactions.
 </p></div>
</li>
</ul>
<a name="rwLocks">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>rwLocks</h4>
<pre>protected final&nbsp;<a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/Pair.html" title="class in fabric.common.util">Pair</a>&lt;java.lang.Long,<a href="../../../fabric/common/util/LongKeyMap.html" title="interface in fabric.common.util">LongKeyMap</a>&lt;<a href="../../../fabric/common/util/MutableInteger.html" title="class in fabric.common.util">MutableInteger</a>&gt;&gt;&gt; rwLocks</pre>
<div class="block"><p>
 Tracks the read/write locks for each onum. Maps each onum to a pair. The
 first component of the pair is the tid for the write-lock holder. The
 second component is a map from the of tids for the read-lock holders to the
 number of workers in the transaction that have read locks on the onum.
 </p>
 <p>
 This should be recomputed from the set of prepared transactions when
 restoring from stable storage.
 </p></div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ObjectDB(java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ObjectDB</h4>
<pre>protected&nbsp;ObjectDB(java.lang.String&nbsp;name)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="beginTransaction(long, fabric.lang.security.Principal)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>beginTransaction</h4>
<pre>public final&nbsp;void&nbsp;beginTransaction(long&nbsp;tid,
                    <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)
                            throws <a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></pre>
<div class="block">Opens a new transaction.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>worker</code> - the worker under whose authority the transaction is running.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></code> - if the worker has insufficient privileges.</dd></dl>
</li>
</ul>
<a name="registerRead(long, fabric.lang.security.Principal, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerRead</h4>
<pre>public final&nbsp;void&nbsp;registerRead(long&nbsp;tid,
                <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker,
                long&nbsp;onum)</pre>
<div class="block">Registers that a transaction has read an object.</div>
</li>
</ul>
<a name="registerUpdate(long, fabric.lang.security.Principal, fabric.common.SerializedObject)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerUpdate</h4>
<pre>public final&nbsp;void&nbsp;registerUpdate(long&nbsp;tid,
                  <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker,
                  <a href="../../../fabric/common/SerializedObject.html" title="class in fabric.common">SerializedObject</a>&nbsp;obj)</pre>
<div class="block">Registers that a transaction has created or written to an object. This
 update will not become visible in the store until commit() is called for
 the transaction.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>tid</code> - the identifier for the transaction.</dd><dd><code>obj</code> - the updated object.</dd></dl>
</li>
</ul>
<a name="abortPrepare(long, fabric.lang.security.Principal)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>abortPrepare</h4>
<pre>public final&nbsp;void&nbsp;abortPrepare(long&nbsp;tid,
                <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</pre>
<div class="block">Rolls back a partially prepared transaction. (i.e., one for which
 finishPrepare() has yet to be called.)</div>
</li>
</ul>
<a name="finishPrepare(long, fabric.lang.security.Principal)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>finishPrepare</h4>
<pre>public abstract&nbsp;void&nbsp;finishPrepare(long&nbsp;tid,
                 <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)</pre>
<div class="block"><p>
 Notifies the database that the given transaction is finished preparing. The
 transaction is not considered to be prepared until this is called. After
 calling this method, there should not be any further calls to
 registerRead() or registerUpdate() for the given transaction. This method
 MUST be called before calling commit().
 </p>
 <p>
 Upon receiving this call, the object database should save the prepared
 transaction to stable storage so that it can be recovered in case of
 failure.
 </p></div>
</li>
</ul>
<a name="commit(long, fabric.lang.security.Principal, fabric.store.SubscriptionManager)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>commit</h4>
<pre>public abstract&nbsp;void&nbsp;commit(long&nbsp;tid,
          <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;workerPrincipal,
          <a href="../../../fabric/store/SubscriptionManager.html" title="class in fabric.store">SubscriptionManager</a>&nbsp;sm)
                     throws <a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></pre>
<div class="block">Cause the objects prepared in transaction [tid] to be committed. The
 changes will hereafter be visible to read.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>tid</code> - the transaction id</dd><dd><code>workerNode</code> - the remote worker that is performing the commit</dd><dd><code>workerPrincipal</code> - the principal requesting the commit</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></code> - if the principal differs from the caller of prepare()</dd></dl>
</li>
</ul>
<a name="rollback(long, fabric.lang.security.Principal)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>rollback</h4>
<pre>public abstract&nbsp;void&nbsp;rollback(long&nbsp;tid,
            <a href="../../../fabric/lang/security/Principal.html" title="interface in fabric.lang.security">Principal</a>&nbsp;worker)
                       throws <a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></pre>
<div class="block">Cause the objects prepared in transaction [tid] to be discarded.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>tid</code> - the transaction id</dd><dd><code>worker</code> - the principal requesting the rollback</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></code> - if the principal differs from the caller of prepare()</dd></dl>
</li>
</ul>
<a name="read(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>read</h4>
<pre>public abstract&nbsp;<a href="../../../fabric/common/SerializedObject.html" title="class in fabric.common">SerializedObject</a>&nbsp;read(long&nbsp;onum)</pre>
<div class="block">Return the object stored at a particular onum.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>onum</code> - the identifier</dd>
<dt><span class="strong">Returns:</span></dt><dd>the object or null if no object exists at the given onum</dd></dl>
</li>
</ul>
<a name="getVersion(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getVersion</h4>
<pre>public&nbsp;int&nbsp;getVersion(long&nbsp;onum)
               throws <a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></pre>
<div class="block">Returns the version number on the object stored at a particular onum.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../fabric/common/exceptions/AccessException.html" title="class in fabric.common.exceptions">AccessException</a></code> - if no object exists at the given onum.</dd></dl>
</li>
</ul>
<a name="getCachedGroupID(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCachedGroupID</h4>
<pre>public final&nbsp;java.lang.Long&nbsp;getCachedGroupID(long&nbsp;onum)</pre>
<div class="block">Given the ID of the group to which the given onum belongs. Null is returned
 if no such group exists.</div>
</li>
</ul>
<a name="getCachedPartialGroup(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCachedPartialGroup</h4>
<pre>public final&nbsp;<a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;getCachedPartialGroup(long&nbsp;onum)</pre>
<div class="block">Gives the cached partial group for the given onum. Null is returned if no
 such partial group exists.</div>
</li>
</ul>
<a name="getCachedGroupContainer(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCachedGroupContainer</h4>
<pre>public final&nbsp;<a href="../../../fabric/store/db/GroupContainer.html" title="class in fabric.store.db">GroupContainer</a>&nbsp;getCachedGroupContainer(long&nbsp;onum)</pre>
<div class="block">Returns the cached GroupContainer containing the given onum. Null is
 returned if no such GroupContainer exists.</div>
</li>
</ul>
<a name="cachePartialGroup(fabric.store.PartialObjectGroup)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>cachePartialGroup</h4>
<pre>public final&nbsp;void&nbsp;cachePartialGroup(<a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;partialGroup)</pre>
<div class="block">Inserts the given partial group into the cache.</div>
</li>
</ul>
<a name="coalescePartialGroups(fabric.store.PartialObjectGroup, fabric.store.PartialObjectGroup)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>coalescePartialGroups</h4>
<pre>public&nbsp;void&nbsp;coalescePartialGroups(<a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;from,
                         <a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;to)</pre>
<div class="block">Coalesces one partial group into another.</div>
</li>
</ul>
<a name="promotePartialGroup(java.security.PrivateKey, fabric.store.PartialObjectGroup)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>promotePartialGroup</h4>
<pre>public&nbsp;<a href="../../../fabric/store/db/GroupContainer.html" title="class in fabric.store.db">GroupContainer</a>&nbsp;promotePartialGroup(java.security.PrivateKey&nbsp;signingKey,
                                 <a href="../../../fabric/store/PartialObjectGroup.html" title="class in fabric.store">PartialObjectGroup</a>&nbsp;partialGroup)</pre>
</li>
</ul>
<a name="notifyCommittedUpdate(fabric.store.SubscriptionManager, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>notifyCommittedUpdate</h4>
<pre>protected final&nbsp;void&nbsp;notifyCommittedUpdate(<a href="../../../fabric/store/SubscriptionManager.html" title="class in fabric.store">SubscriptionManager</a>&nbsp;sm,
                         long&nbsp;onum)</pre>
<div class="block">Performs operations in response to a committed object update. Removes from
 cache the glob associated with the onum and notifies the subscription
 manager of the update.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>onum</code> - the onum of the object that was updated.</dd><dd><code>worker</code> - the worker that performed the update.</dd></dl>
</li>
</ul>
<a name="isPrepared(long, long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isPrepared</h4>
<pre>public final&nbsp;boolean&nbsp;isPrepared(long&nbsp;onum,
                 long&nbsp;tid)</pre>
<div class="block">Determines whether an onum has an outstanding uncommitted conflicting
 change or read. Outstanding uncommitted changes are always considered
 conflicting. Outstanding uncommitted reads are considered conflicting if
 they are by transactions whose tid is different from the one given.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>onum</code> - the object number in question</dd></dl>
</li>
</ul>
<a name="isWritten(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isWritten</h4>
<pre>public final&nbsp;boolean&nbsp;isWritten(long&nbsp;onum)</pre>
<div class="block">Determine whether an onum has outstanding uncommitted changes.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>onum</code> - the object number in question</dd>
<dt><span class="strong">Returns:</span></dt><dd>true if the object has been changed by a transaction that hasn't
         been committed or rolled back.</dd></dl>
</li>
</ul>
<a name="unpin(fabric.store.db.ObjectDB.PendingTransaction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>unpin</h4>
<pre>protected final&nbsp;void&nbsp;unpin(<a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db">ObjectDB.PendingTransaction</a>&nbsp;tx)</pre>
<div class="block">Adjusts rwLocks to account for the fact that the given transaction is about
 to be committed or aborted.</div>
</li>
</ul>
<a name="newOnums(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newOnums</h4>
<pre>public abstract&nbsp;long[]&nbsp;newOnums(int&nbsp;num)</pre>
<div class="block"><p>
 Return a set of onums that aren't currently occupied. The ObjectDB may
 return the same onum more than once from this method, althogh doing so
 would encourage collisions. There is no assumption of unpredictability or
 randomness about the returned ids.
 </p>
 <p>
 The returned onums should be packed in the lower 48 bits. We assume that
 the object database is never full, and can always provide new onums
 </p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>num</code> - the number of onums to return</dd>
<dt><span class="strong">Returns:</span></dt><dd>num fresh onums</dd></dl>
</li>
</ul>
<a name="exists(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>exists</h4>
<pre>public abstract&nbsp;boolean&nbsp;exists(long&nbsp;onum)</pre>
<div class="block">Checks whether an object with the corresponding onum exists, in either
 prepared or committed form.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>onum</code> - the onum of to check</dd>
<dt><span class="strong">Returns:</span></dt><dd>true if an object exists for onum</dd></dl>
</li>
</ul>
<a name="getName()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getName</h4>
<pre>public final&nbsp;java.lang.String&nbsp;getName()</pre>
<div class="block">Returns the name of this store.</div>
</li>
</ul>
<a name="close()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>close</h4>
<pre>public abstract&nbsp;void&nbsp;close()
                    throws java.io.IOException</pre>
<div class="block">Gracefully shutdown the object database.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="isInitialized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isInitialized</h4>
<pre>protected abstract&nbsp;boolean&nbsp;isInitialized()</pre>
<div class="block">Determines whether the object database has been initialized.</div>
</li>
</ul>
<a name="setInitialized()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setInitialized</h4>
<pre>protected abstract&nbsp;void&nbsp;setInitialized()</pre>
<div class="block">Sets a flag to indicate that the object database has been initialized.</div>
</li>
</ul>
<a name="ensureInit()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ensureInit</h4>
<pre>public final&nbsp;void&nbsp;ensureInit()</pre>
<div class="block">Ensures that the object database has been properly initialized. This
 creates, for example, the name-service map and the store's principal, if
 they do not already exist in the database.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../fabric/store/db/MemoryDB.html" title="class in fabric.store.db"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../fabric/store/db/ObjectDB.PendingTransaction.html" title="class in fabric.store.db"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?fabric/store/db/ObjectDB.html" target="_top">Frames</a></li>
<li><a href="ObjectDB.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
