import java.io.PrintStream;
import fabric.util.Map;
import jif.runtime.Runtime;

public class Main {
    public static void main{}(String[]{} args) throws (SecurityException) {
        Core core = null;

	if (args == null) return;

	try {
	    core = client$.getCore(args[0]);
        } catch (ArrayIndexOutOfBoundsException e) {
	}

	Map root = null;
	if (core != null) {
	    root = (Map) core.getRoot();
	}

        if (root == null) return;

	try {
	    final Principal bank = (Principal) root.get("bankPrincipal");
	    final Principal customer = (Principal) root.get("customerPrincipal");
	    final Broker[bank,customer] broker =
	        (Broker[bank,customer]) root.get("theBroker");

	    if (broker != null) {
	        atomic {
	            broker.coordinatePurchase();

//		    Runtime[broker] runtime = Runtime[broker].getRuntime();
//		    try {
//			PrintStream[{broker->}] out = runtime.out();
//			out.println("Purchase succeeded.");
//		    } catch (NullPointerException e) {
//		    }
	        }
	    }
	    if (false) throw new PurchasingError();
	} catch (ClassCastException e) {
	} catch (PurchasingError e) {
	}
    }
}
