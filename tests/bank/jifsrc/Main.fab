import fabric.util.Map;

public class Main {
    public static void main{}(String[]{} args) : {*->*;_<-_} throws PurchasingError {
        Core core = null;

	if (args == null) return;

	try {
	    core = client$.getCore(args[0]);
        } catch (ArrayIndexOutOfBoundsException e) {
	}

	Map root = null;
	if (core != null) {
	    root = (Map) core.getRoot();
	}

        if (root == null) return;

	try {
	    final Principal bank = (Principal) root.get("bankPrincipal");
	    final Principal customer = (Principal) root.get("customerPrincipal");
	    final Broker[bank,customer] broker =
	        (Broker[bank,customer]) root.get("theBroker");
	    if (broker != null)
	        atomic {
	            broker.coordinatePurchase();
	        }
	} catch (ClassCastException e) {
	}
    }
}
