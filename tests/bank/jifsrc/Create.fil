public class Create {

    /**
     * create the setup for the OO7 test:
     *
     * brokerCore (args[0])
     * ==========
     * broker: Broker[bank,customer]
     *  f label        -> brokerLabel
     *  f bank         -> bank
     *  f customer     -> customer
     *    customerAcct -> customerAccount
     *    airlineAcct  -> airlineAccount
     *    airline      -> airline
     *    custTickets  -> tickets
     *
     * bank: DelegatingPrincipal
     *  f label       -> null (gets rewritten to {bank<-; bank->_}
     *    delegatesTo -> broker
     *
     * customer: DelegatingPrincipal
     *  f label       -> null (gets rewritten to {customer<-; customer->_}
     *    delegatesTo -> broker
     *
     * airline: DelegatingPrincipal
     *  f label       -> null
     *    delegatesTo -> broker
     *  
     *
     * bankCore (args[1])
     * ========
     * airlineBalance: Balance[bank,airline]
     *  f label   -> airlineLabel
     *  f bank    -> bank
     *  f user    -> airline
     *    value   -> 0
     *
     * airlineAccount: Account[bank]
     *  f label   -> {bank<-}
     *  f bank    -> bank
     *  f user    -> airline
     *    balance -> airlineBalance
     * 
     * airlineLabel: Label
     *  f {bank<-; bank->airline}
     *
     * customerBalance: Balance[bank,customer]
     *  f label   -> customerLabel
     *  f bank    -> bank
     *  f user    -> customer
     *    value   -> 0
     *
     * customerAccount: Account[bank]
     *  f label   -> {bank<-}
     *  f bank    -> bank
     *  f user    -> customer
     *    balance -> customerBalance
     *
     * customerLabel: Label
     *  f {bank<-; bank->customer}
     *  
     * airlineCore (args[2])
     * ===========
     * tickets: Tickets[bank,airline,user]
     *  f label   -> ticketsLabel
     *  f bank    -> bank
     *  f airline -> airline
     *  f user    -> customer
     *    count   -> 0
     *
     * ticketsLabel: Label
     *  f {bank<-airline}
     */
    public static void main(String[] args) {
        atomic {
            Core  brokerCore = Client.getClient().getCore(args[0]);
            Core    bankCore = Client.getClient().getCore(args[1]);
            Core airlineCore = Client.getClient().getCore(args[2]);

            Principal bank     = new AbstractPrincipal@brokerCore().jif$lang$AbstractPrincipal$("bank");
            Principal customer = new AbstractPrincipal@brokerCore().jif$lang$AbstractPrincipal$("customer");
            Principal airline  = new AbstractPrincipal@brokerCore().jif$lang$AbstractPrincipal$("airline");
            Broker    broker   = new Broker@brokerCore(bank,customer);

            IntPolicy  brokerTrusted  = LabelUtil.writerPolicy(brokerCore,  broker, broker);   // {broker<-}
            IntPolicy  bankTrusted    = LabelUtil.writerPolicy(brokerCore,  bank,   bank);     // {bank<-}
            IntPolicy  airlineTrusted = LabelUtil.writerPolicy(airlineCore, bank,   airline);  // {bank<-airline} 
            ConfPolciy airlineSecret  = LabelUtil.readerPolicy(bankCore,    bank,   airline);  // {bank->airline}
            ConfPolicy customerSecret = LabelUtil.readerPolicy(bankCore,    bank,   customer); // {bank->customer}

            Label airlineLabel  = LabelUtil.toLabel(bankCore,    bankTrusted, airlineSecret);
            Label customerLabel = LabelUtil.toLabel(bankCore,    bankTrusted, customerSecret);
            Label ticketsLabel  = LabelUtil.toLabel(airlineCore, airlineTrusted);

            Account  airlineAccount = new Balance~airlineLabel@bankCore (bank, airline).Balance$();
            Account customerAccount = new Balance~customerLabel@bankCore(bank,customer).Balance$();

            Tickets tickets = new Tickets~ticketsLabel@airlineCore(bank,airline,customer).Tickets$();

            // call broker constructor
            broker = broker.Broker$(customerAccount,airlineAccount,tickets,airline);
            
            // make broker top
            airline.addDelegatesTo(broker);
               bank.addDelegatesTo(broker);

            // add core delegations
            airline.addDelegatesTo(airlineCore);
             broker.addDelegatesTo(brokerCore);
               bank.addDelegatesTo(bankCore);

            // add client delegations
            Client  brokerClient = Client.getClient(args[0]);
            Client    bankClient = Client.getClient(args[1]);
            Client airlineClient = Client.getClient(args[2]);

            airline.addDelegatesTo(airlineClient);
             broker.addDelegatesTo(brokerClient);
               bank.addDelegatesTo(bankClient);
        }
    }
}

/*
** vim: ts=4 sw=4 et cindent cino=\:0
*/
