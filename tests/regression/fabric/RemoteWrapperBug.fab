package tests;
/**
 * {SN<-A} = provider
 */
//XXX: BUG: During serialization of today_remote() we get a stack overflow.
// Strangely, only when sourcepath is specified.

public class Agent[principal A, principal SN] 
    where SN actsfor A, {*provider} actsfor A, {*provider} <= {SN<-A} {
  public int{SN<-} today() { return 10; }

  public void happyBirthday{bdayPerson<-bdayUser.friends, A}
      (final principal{SN<-} bdayPerson, RemoteWrapperBugHelper[bdayPerson, SN]{SN<-} bdayUser)
      where SN actsfor bdayPerson, SN actsfor bdayUser.friends {
	  //TODO: comment this check : (I don't understand it)
      if (bdayUser.lbl <= new label {bdayPerson-> ; bdayPerson<-bdayUser.friends}) {
	  //Does the agent actfor a friend of the user?
      if (A actsfor bdayUser.friends) {
        if (bdayUser.birthday == today()) {
          bdayUser.wall = bdayUser.wall + "Happy birthday!\n";
        }
      }
    }
  }
}
