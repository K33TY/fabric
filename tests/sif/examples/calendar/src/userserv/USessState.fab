package userserv;

import sif.servlet.SessionState;
import jif.util.*;

public class USessState[principal servP, covariant label T] extends SessionState[T] {
    UserWrapper[servP,{remote.sessionPrincipal!:}]{⊥→⊥;⊤←⊤} uwrapper;
    
    public User[servP,{this.remote.sessionPrincipal!:}]{this.remote.sessionPrincipal!:} currentUser() {
    	if(uwrapper == null) return null;
        return uwrapper.currentUser;
    }
    
    void currentUser{remote.sessionPrincipal!:}(User[servP,{remote.sessionPrincipal!:}]{remote.sessionPrincipal!:} cu) { 
    	if(uwrapper == null) {
    		uwrapper = new UserWrapper[servP,{remote.sessionPrincipal!:}]();
    	}
		uwrapper.currentUser(cu); 
    }
}

class UserWrapper[principal servP, label L] {

	User[servP,{L}]{L} currentUser = null;
    void currentUser{L}(User[servP,{L}]{L} cu) { 
        currentUser = cu; 
    }
	
}
