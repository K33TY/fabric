package jif.principals;

import fabric.util.Map;
import travel.Config;

public class AirlinePrincipal extends ExternalPrincipal {
  public AirlinePrincipal() {
    super("customer");
  }
  
  public static AirlinePrincipal{*!:} getInstance{*!:}() {
    atomic {
      FabricClient cl = FabricClient.getClient();
      if (cl != null) {
        final Core brokerCore = cl.getCore(Config.brokerCoreName);
        if (brokerCore != null) {
          Map rootMap = brokerCore.getRoot();
          if (rootMap != null) {
            Object obj = rootMap.get(Config.airlinePrincipalMapKey);
            AirlinePrincipal airlinePrincipal = null;
            if (obj instanceof AirlinePrincipal) {
              airlinePrincipal = (AirlinePrincipal) obj;
            } else {
              airlinePrincipal = new AirlinePrincipal@brokerCore();
              rootMap.put(Config.airlinePrincipalMapKey, airlinePrincipal);
            }
            
            return airlinePrincipal;
          }
        }
      }
      
      return null;
    }
  }

  // Don't much care what core is, we're going to create it where we want
  public static AirlinePrincipal{*!:} getInstance{*!:}(Core core) {
      return getInstance();
  }
  
}
