package travel;

import java.io.PrintStream;
import fabric.util.Map;
import jif.runtime.Runtime;

public class Main {
    public static boolean{BankPrincipal→AirlinePrincipal; BankPrincipal→CustomerPrincipal;broker←;BankPrincipal←;AirlinePrincipal←;CustomerPrincipal←}
      startTxImpl{CustomerPrincipal←}(
            float{CustomerPrincipal→BankPrincipal, AirlinePrincipal} amount,
            Broker[BankPrincipal, CustomerPrincipal]{CustomerPrincipal←} broker)
    where   broker actsfor BankPrincipal,
            broker actsfor broker.airline,
            broker.airlineAcct.user equiv AirlinePrincipal,
            broker.customerAcct.user equiv CustomerPrincipal,
            broker.airline equiv AirlinePrincipal
    {
        Core core = client$.getCore(Config.brokerCoreName);
        Map root = null;
        if (core != null) {
            root = (Map) core.getRoot();
        }

        if (root == null) return false;

        try {
//            final Principal bank = (Principal) root.get(Config.bankPrincipalMapKey);
//            final Principal customer = (Principal) root.get(Config.customerPrincipalMapKey);

            if (broker != null) {
                atomic {
                        broker.coordinatePurchase(amount);
                        return true;
                }
            }
        } catch (PurchasingError e) {}
          
        return false;
    }
      
      public static boolean{BankPrincipal→AirlinePrincipal; BankPrincipal→CustomerPrincipal;broker←;BankPrincipal←;AirlinePrincipal←;CustomerPrincipal←}
      startTx{CustomerPrincipal←}(
            float{CustomerPrincipal→BankPrincipal, AirlinePrincipal} amount,
            Broker[BankPrincipal, CustomerPrincipal]{CustomerPrincipal←} broker)  {
          if (broker actsfor BankPrincipal && broker actsfor broker.airline
                  && broker.airlineAcct != null
                  && broker.airlineAcct.user equiv AirlinePrincipal
                  && broker.customerAcct != null
                  && broker.customerAcct.user equiv CustomerPrincipal
                  && broker.airline equiv AirlinePrincipal) {
              return startTxImpl(amount, broker);
          }
          return false;
      }
    
}
