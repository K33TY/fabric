package tree;

import java.util.Random;
import fabric.client.AbortException;
import fabric.client.Core;
import fabric.client.Client;
import fabric.util.Map;

public class Main {
  public static void main(String[] args) throws AbortException {
    if (args.length != 1 || !args[0].equals("create") && !args[0].equals("read")) {
      System.out.println("Usage: tree.Main [create|read]");
      return;
    }
    
    Client client = fabric.client.Client.getClient();
    Map root = (Map) client.getCore("1").getRoot();
    Random random = new Random();
    Tree tree;
    if (args[0].equals("create")) {
      atomic {
        Core treeCore = client.getCore("0");
        Core nodeCore = client.getCore("1");
        tree = new Tree@treeCore(nodeCore);
        root.put("theTree", tree);
        for (int i = 0; i < 500; i++) {
          atomic {
            int toInsert = random.nextInt();
            tree.insertIterative(toInsert);
          }
        }
      }
      return;
    }

    tree = (Tree) root.get("theTree"); 

    int cycle = 0;
    while (true) {
      atomic {
        int toFind = random.nextInt();
        tree.lookup(toFind);
      }

      if (++cycle % 100 == 0)
      System.out.println(cycle + " lookups done.");
    }
  }
}

/*
 * * vim: ts=2 sw=2 et cindent cino=\:0 syntax=java
 */
