package travel.servlet;

import java.util.*;
import sif.servlet.Servlet;
import sif.servlet.Request;
import sif.servlet.SessionState;
import sif.servlet.SessionPrincipal;

import javax.servlet.ServletException;

public final class Customer extends Servlet[HelloServEP] {
    final Core{this} localCore;
    public Customer() throws ServletException {
        FabricClient cl = FabricClient.getClient();
        Core lCore = null;        
        if(cl != null) {
            lCore = cl.getLocalCore();
        }
        localCore = lCore;
    }
    
    public void initialize{HelloServEP:;HelloServEP!:}() throws ServletException {
        addStartAction(new StartAction(this));
//        HelloAction2 ha = new HelloAction2(this);
//        addStartAction(ha);
//        HelloAction2.precomputePage(this, ha);
    }
    
    
    public String getPrivateHostID() throws ServletException {
        return "";
    }

    protected String defaultActionName(Request[HelloServEP] req) {
        return "greet";
    }
    
    // This method will only be called by the runtime
    protected SessionState[lbl]{*lbl} createSessionState{*lbl}(label{*lbl} lbl,
            String{*lbl} id, SessionPrincipal{*lbl} session) {
        SessionState[lbl] toReturn = null;
        atomic {
            if (localCore != null && localCore equiv client$ &&
                    lbl <= new label {⊤→client$} && 
                    new label {⊤←client$} <= lbl) {
                toReturn = new SessionState[lbl]@localCore(id, session);
            }
        }
        return toReturn;
    }
    
    // This method will only be called by the runtime
    protected SessionPrincipal createSessionPrincipal(String{client$→;client$←} id) {
        SessionPrincipal toReturn = null;
        atomic {
            if (localCore != null && localCore equiv client$) {
                toReturn = new SessionPrincipal@localCore(id);
            }
        }
        return toReturn;
    }
    
    
}

